<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Evan AI (Pro)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <style>
        :root {
            --bg-color: #131314;       
            --input-bg: #1e1f20;
            --text-primary: #e3e3e3;
            --user-bubble: #282a2c;
            --accent-blue: #4285f4;
        }
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; padding: 0; height: 100vh; font-family: 'Roboto', sans-serif; background-color: var(--bg-color); color: var(--text-primary); display: flex; flex-direction: column; }

        /* HEADER */
        header { padding: 15px 20px; display: flex; align-items: center; gap: 10px; background: var(--bg-color); z-index: 10; }
        .brand { font-size: 1.3rem; font-weight: 500; display: flex; align-items: center; gap: 10px; }
        
        /* CHAT AREA */
        #chat-container { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; display: flex; flex-direction: column; gap: 20px; }
        #chat-container::-webkit-scrollbar { width: 8px; }
        #chat-container::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }

        /* MESSAGE STYLES */
        .message-wrapper { display: flex; gap: 15px; opacity: 0; animation: fadeUp 0.3s forwards; line-height: 1.6; max-width: 100%; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .avatar { width: 32px; height: 32px; flex-shrink: 0; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        
        /* User (Kanan) */
        .message-wrapper.user { flex-direction: row-reverse; }
        .message-wrapper.user .message-content {
            background-color: var(--user-bubble); padding: 10px 20px; border-radius: 18px; border-top-right-radius: 4px; max-width: 85%;
        }

        /* Assistant (Kiri) */
        .message-wrapper.assistant .message-content { background: transparent; width: 100%; overflow-x: hidden; }

        /* Markdown Elements */
        .assistant strong { color: #fff; font-weight: 700; }
        .assistant p { margin: 0 0 10px 0; }
        .assistant pre { background: #1e1f20; border-radius: 8px; padding: 15px; overflow-x: auto; border: 1px solid #333; margin: 10px 0; }
        .assistant code { font-family: 'Consolas', monospace; font-size: 0.9em; }

        /* INPUT AREA */
        .input-container { position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, var(--bg-color) 20%); padding: 20px; display: flex; justify-content: center; }
        .input-box { background-color: var(--input-bg); width: 100%; max-width: 900px; border-radius: 35px; padding: 8px 10px 8px 25px; display: flex; align-items: center; border: 1px solid transparent; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .input-box:focus-within { border-color: #555; background-color: #252627; }
        #user-input { flex: 1; background: transparent; border: none; color: white; font-size: 1rem; padding: 10px 0; font-family: inherit; }
        #send-btn { background: #fff; color: #000; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; margin-left: 10px; }
        #send-btn:hover { transform: scale(1.05); }
        #send-btn:disabled { background: #555; cursor: not-allowed; }

        /* Utility */
        .msg-toolbar { margin-top: 5px; display: flex; gap: 10px; }
        .icon-btn { background: transparent; border: none; color: #888; cursor: pointer; padding: 5px; border-radius: 50%; }
        .icon-btn:hover { color: #fff; background: rgba(255,255,255,0.1); }
        .typing span { display: inline-block; width: 6px; height: 6px; background: #aaa; border-radius: 50%; animation: blink 1.4s infinite both; margin: 0 2px; }
        @keyframes blink { 50% { opacity: 0.2; } }
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <svg width="24" height="24" viewBox="0 0 24 24">
                <defs><linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#4285f4"/><stop offset="100%" style="stop-color:#d96570"/></linearGradient></defs>
                <path fill="url(#g1)" d="M12 2L14.4 9.6L22 12L14.4 14.4L12 22L9.6 14.4L2 12L9.6 9.6L12 2Z"/>
            </svg>
            Evan AI
        </div>
    </header>

    <div id="chat-container">
        <div class="message-wrapper assistant">
            <div class="avatar"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="url(#g1)" d="M12 2L14.4 9.6L22 12L14.4 14.4L12 22L9.6 14.4L2 12L9.6 9.6L12 2Z"/></svg></div>
            <div class="message-content"><p>Halo! Saya sudah di-update. Sekarang saya lebih pintar mematuhi format jawaban (seperti A, B, C, D) dan tetap jago analisis. Mau coba tes?</p></div>
        </div>
    </div>

    <div class="input-container">
        <form class="input-box" onsubmit="sendMessage(event)">
            <input type="text" id="user-input" placeholder="Tanya sesuatu..." autocomplete="off">
            <button type="submit" id="send-btn"><svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button>
        </form>
    </div>

    <script>
        // --- API KEY ---
        const MY_API_KEY = "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"; 
        
        // --- OTAK BARU (SMART & OBEDIENT) ---
        const SYSTEM_PROMPT = `
Kamu adalah Evan AI, asisten yang sangat cerdas, adaptif, dan patuh.

ATURAN UTAMA (WAJIB DIPATUHI):
1. JIKA user meminta jawaban format khusus (contoh: "Hanya jawab A/B/C/D", "Hanya kode saja", "Singkat saja"), MAKA kamu harus mematuhi itu TANPA memberikan penjelasan tambahan yang tidak diminta.
2. JIKA pertanyaan bersifat diskusi/terbuka, barulah gunakan kemampuan analisis mendalam, berpikir kritis, dan terstruktur.
3. Selalu gunakan Bahasa Indonesia yang baik, kecuali diminta bahasa lain.
4. Gunakan format Markdown (Bold, Code Block, List) agar jawaban mudah dibaca.

Ingat: Kepatuhan pada instruksi format user adalah prioritas tertinggi.
        `;

        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');

        marked.setOptions({
            highlight: (code, lang) => highlight.getLanguage(lang) ? highlight.highlight(code, { language: lang }).value : highlight.highlightAuto(code).value,
            breaks: true
        });

        async function sendMessage(e) {
            e.preventDefault();
            const text = userInput.value.trim();
            if (!text) return;

            userInput.value = '';
            userInput.disabled = true;
            sendBtn.disabled = true;

            appendMessage(text, 'user');
            const loadingId = showLoading();

            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${MY_API_KEY}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [{ role: "system", content: SYSTEM_PROMPT }, { role: "user", content: text }],
                        model: "llama-3.3-70b-versatile",
                        temperature: 0.5, // Sedikit lebih kaku agar lebih nurut perintah format
                        max_tokens: 4096
                    })
                });

                const data = await response.json();
                removeLoading(loadingId);

                if (data.error) appendMessage("⚠️ Error: " + data.error.message, 'assistant');
                else appendMessage(data.choices[0].message.content, 'assistant');

            } catch (err) {
                removeLoading(loadingId);
                appendMessage("❌ Gagal koneksi.", 'assistant');
            } finally {
                userInput.disabled = false;
                sendBtn.disabled = false;
                userInput.focus();
            }
        }

        function appendMessage(text, role) {
            const wrapper = document.createElement('div');
            wrapper.className = `message-wrapper ${role}`;

            if (role === 'assistant') {
                wrapper.innerHTML = `
                    <div class="avatar"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="url(#g1)" d="M12 2L14.4 9.6L22 12L14.4 14.4L12 22L9.6 14.4L2 12L9.6 9.6L12 2Z"/></svg></div>
                    <div class="message-content">${marked.parse(text)}<div class="msg-toolbar"><button class="icon-btn" onclick="navigator.clipboard.writeText(this.parentElement.previousSibling.innerText)"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button></div></div>
                `;
            } else {
                const content = document.createElement('div');
                content.className = 'message-content';
                content.innerText = text;
                wrapper.appendChild(content);
            }
            chatContainer.appendChild(wrapper);
            window.scrollTo(0, document.body.scrollHeight);
        }

        function showLoading() {
            const id = 'load-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'message-wrapper assistant';
            div.innerHTML = `<div class="avatar"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="url(#g1)" d="M12 2L14.4 9.6L22 12L14.4 14.4L12 22L9.6 14.4L2 12L9.6 9.6L12 2Z"/></svg></div><div class="message-content typing"><span></span><span></span><span></span></div>`;
            chatContainer.appendChild(div);
            window.scrollTo(0, document.body.scrollHeight);
            return id;
        }
        function removeLoading(id) { document.getElementById(id)?.remove(); }
    </script>
</body>
</html>
