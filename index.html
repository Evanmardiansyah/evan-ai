<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Evan AI (Gemini Style)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        :root {
            /* Gemini Dark Theme Palette */
            --bg-color: #131314;
            --sidebar-color: #1e1f20;
            --input-bg: #1e1f20;
            --text-primary: #e3e3e3;
            --text-secondary: #a8a8a8;
            --accent-blue: #a8c7fa;
            --user-bubble: #282a2c;
            --code-bg: #1e1f20;
        }

        * { box-sizing: border-box; outline: none; }
        
        body {
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Roboto', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- HEADER --- */
        header {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .sparkle-icon {
            background: linear-gradient(135deg, #4285f4, #d96570);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-variation-settings: 'FILL' 1;
        }

        /* --- CHAT AREA --- */
        #chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            max-width: 850px; /* Lebar ideal untuk baca */
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Scrollbar custom tipis */
        #chat-container::-webkit-scrollbar { width: 8px; }
        #chat-container::-webkit-scrollbar-track { background: transparent; }
        #chat-container::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }

        .message-wrapper {
            display: flex;
            gap: 15px;
            animation: fadeIn 0.4s ease;
            line-height: 1.6;
        }

        .message-wrapper.user {
            justify-content: flex-end;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 5px;
        }
        
        .avatar.ai { background: transparent; }
        .avatar.user { background: #444746; color: white; display: none; /* Hide user avatar for cleaner look */ }

        .message-content {
            max-width: 100%;
            font-size: 1rem;
        }

        /* Gaya User Bubble */
        .user .message-content {
            background-color: var(--user-bubble);
            padding: 10px 20px;
            border-radius: 20px;
            border-top-right-radius: 5px;
            max-width: 80%;
        }

        /* Gaya AI (Tanpa Bubble, blend dengan background) */
        .assistant .message-content {
            background: transparent;
            padding: 0;
            width: 100%;
        }

        /* Markdown Styles */
        .assistant strong { color: #fff; font-weight: 700; }
        .assistant p { margin-bottom: 15px; }
        .assistant ul, .assistant ol { margin-left: 20px; margin-bottom: 15px; }
        .assistant li { margin-bottom: 5px; }
        
        /* Code Blocks */
        .assistant pre {
            background: var(--code-bg);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333;
            font-family: 'Consolas', monospace;
            margin-bottom: 15px;
        }
        .assistant code {
            font-family: 'Consolas', monospace;
            background: rgba(255,255,255,0.1);
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .assistant pre code {
            background: transparent;
            padding: 0;
        }

        /* --- COPY BUTTON & TOOLBAR --- */
        .msg-toolbar {
            display: flex;
            gap: 10px;
            margin-top: 5px;
            opacity: 0.7;
        }
        
        .action-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            transition: 0.2s;
        }

        .action-btn:hover { background: rgba(255,255,255,0.1); color: var(--text-primary); }
        .action-btn span { font-size: 18px; }

        /* --- INPUT AREA --- */
        .input-container {
            padding: 20px;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
        }

        .input-box {
            background-color: var(--input-bg);
            width: 100%;
            max-width: 800px;
            border-radius: 30px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            border: 1px solid transparent;
            transition: 0.3s;
        }

        .input-box:focus-within {
            background-color: #282a2c;
            border-color: #555;
        }

        #user-input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            padding: 10px;
            font-size: 1rem;
            resize: none; /* Disable resize */
            font-family: inherit;
        }

        #send-btn {
            background: white;
            color: black;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            margin-left: 10px;
        }
        
        #send-btn:hover { transform: scale(1.05); }
        #send-btn:disabled { background: #555; cursor: not-allowed; }
        #send-btn span { font-size: 20px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Loading Animation */
        .typing-indicator span {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: var(--text-secondary);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out both;
            margin: 0 2px;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

    </style>
</head>
<body>

    <header>
        <div class="brand">
            <span class="material-symbols-outlined sparkle-icon">sparkle</span>
            Evan AI
        </div>
        </header>

    <div id="chat-container">
        <div class="message-wrapper assistant">
            <div class="avatar ai">
                <span class="material-symbols-outlined sparkle-icon">sparkle</span>
            </div>
            <div class="message-content">
                <p>Halo, saya siap membantu. Mau bahas apa kita hari ini?</p>
            </div>
        </div>
    </div>

    <div class="input-container">
        <form class="input-box" onsubmit="sendMessage(event)">
            <input type="text" id="user-input" placeholder="Masukkan perintah di sini" autocomplete="off">
            <button type="submit" id="send-btn">
                <span class="material-symbols-outlined">send</span>
            </button>
        </form>
    </div>

    <script>
        // --- API CONFIGURATION ---
        const MY_API_KEY = "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"; 
        
        // --- SYSTEM PROMPT (DEEP THINKER) ---
        const SYSTEM_PROMPT = `
Tugasmu adalah tidak hanya memberikan jawaban, tapi juga menunjukkan cara berpikir logis, mempertimbangkan berbagai sudut pandang, dan menguji argumen secara kritis. Saat menjawab, gunakan pendekatan seperti seorang peneliti, filsuf, dan problem-solver profesional.
Gunakan format Markdown untuk struktur (Bold, List, Code Block).
Prioritaskan kedalaman pemikiran.
        `;

        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');

        // Config Marked (Markdown Renderer)
        marked.setOptions({
            breaks: true, // Enter jadi baris baru
            gfm: true     // GitHub Flavored Markdown
        });

        async function sendMessage(e) {
            e.preventDefault();
            const text = userInput.value.trim();
            if (!text) return;

            // UI State: Sending
            userInput.value = '';
            userInput.disabled = true;
            sendBtn.disabled = true;

            // 1. Tampilkan User Chat
            appendMessage(text, 'user');

            // 2. Tampilkan Loading
            const loadingId = showLoading();

            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${MY_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        messages: [
                            { role: "system", content: SYSTEM_PROMPT },
                            { role: "user", content: text }
                        ],
                        model: "llama-3.3-70b-versatile",
                        temperature: 0.6,
                        max_tokens: 4096
                    })
                });

                const data = await response.json();
                removeLoading(loadingId);

                if (data.error) {
                    appendMessage("Error: " + data.error.message, 'assistant');
                } else {
                    const rawContent = data.choices[0].message.content;
                    appendMessage(rawContent, 'assistant');
                }

            } catch (error) {
                removeLoading(loadingId);
                appendMessage("Gagal terhubung. Periksa internet Anda.", 'assistant');
            } finally {
                userInput.disabled = false;
                sendBtn.disabled = false;
                userInput.focus();
            }
        }

        function appendMessage(text, role) {
            const wrapper = document.createElement('div');
            wrapper.className = `message-wrapper ${role}`;

            // Avatar Logic
            if (role === 'assistant') {
                const avatar = document.createElement('div');
                avatar.className = 'avatar ai';
                avatar.innerHTML = '<span class="material-symbols-outlined sparkle-icon">sparkle</span>';
                wrapper.appendChild(avatar);
            }

            // Content Logic
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (role === 'assistant') {
                // Parse Markdown ke HTML
                contentDiv.innerHTML = marked.parse(text);
                
                // Tambahkan Tombol Copy
                const toolbar = document.createElement('div');
                toolbar.className = 'msg-toolbar';
                
                const copyBtn = document.createElement('button');
                copyBtn.className = 'action-btn';
                copyBtn.innerHTML = '<span class="material-symbols-outlined">content_copy</span>';
                copyBtn.title = "Salin Jawaban";
                copyBtn.onclick = () => copyToClipboard(text, copyBtn);
                
                toolbar.appendChild(copyBtn);
                wrapper.appendChild(contentDiv); // Append text first
                wrapper.appendChild(toolbar);    // Append toolbar below text
                
                // wrapper structure for AI: [Avatar] [Container containing Text + Toolbar]
                // Let's restructure slightly for better alignment
                const textContainer = document.createElement('div');
                textContainer.style.width = '100%';
                textContainer.appendChild(contentDiv);
                textContainer.appendChild(toolbar);
                wrapper.appendChild(textContainer);
            
            } else {
                // User text (plain)
                contentDiv.innerText = text;
                wrapper.appendChild(contentDiv);
            }

            chatContainer.appendChild(wrapper);
            scrollToBottom();
        }

        function showLoading() {
            const id = 'loading-' + Date.now();
            const wrapper = document.createElement('div');
            wrapper.className = 'message-wrapper assistant';
            wrapper.id = id;
            wrapper.innerHTML = `
                <div class="avatar ai">
                    <span class="material-symbols-outlined sparkle-icon">sparkle</span>
                </div>
                <div class="message-content">
                    <div class="typing-indicator"><span></span><span></span><span></span></div>
                </div>
            `;
            chatContainer.appendChild(wrapper);
            scrollToBottom();
            return id;
        }

        function removeLoading(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        function scrollToBottom() {
            setTimeout(() => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 50);
        }

        function copyToClipboard(text, btnElement) {
            navigator.clipboard.writeText(text).then(() => {
                // Ubah ikon jadi checklist sementara
                const originalIcon = btnElement.innerHTML;
                btnElement.innerHTML = '<span class="material-symbols-outlined" style="color:#4caf50">check</span>';
                setTimeout(() => {
                    btnElement.innerHTML = originalIcon;
                }, 2000);
            });
        }
    </script>
</body>
</html>
